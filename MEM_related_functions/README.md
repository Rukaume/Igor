
## データの読み込みからMEMのやり方

0. 用意するもの
Igor8
測定データ (.spe)
バックグラウンドデータ (.spe)
ノンレゾナントバックグラウンド(.spe),
DataLoad_Preprocessing.ipf
x軸 (.itx)
1. Igor8の起動
2. 関数をドラッグアンドドロップしてcompile (下のほうに小さくcompileとあるのでクリック)
3. コマンドラインを呼び出して(ctrl+j), 以下のコード実行
```Igor
SpeloaderM(compact=1) 
	//Igorでは大文字小文字の区別をしていないので, 全部小文字でも動きます
```
上記でファイル選択画面が開くので, 解析したい測定データを選択する
4. 読み込みの際に名前を付けられるので, 適当に名前を付ける (rawなどとすると, "raw0"という名前になる. データブラウザ(ctrl+b)で確認可能)
5. 3を2回繰り返して, bg, nrを読みこむ (bg, nrと名付けるとbg0, nr0みたいな名前になる)
6. x軸を読み込むため, .itxデータをドラッグアンドドロップ
7. x軸は勝手に"xwavelength"という名前で読み込まれるので, これを以下のコードで名前を変える. 
```Igor
rename xwavelength ramanshift
```
__これ以降のコードで, x軸がramanshiftという名前でないと動かないコードもあるので, この手順は必ず行うこと__
8. データの前処理のため, 以下のコード実行
```Igor
darknonres(raw0, bg0, nr0)
	//ここは, 読み込みの際にraw, bg, nrという名前にしなかったなら, 
	//自分でつけた名前で実行すること
	//コードの中身をみてもらえばわかるかと思いますが, 
	//rawとnrからbgを引いて, bgを引いたrawをnrで割っています
```
9. 2次元データから4次元データへの変換
測定データ (.spe) は2次元 (波数,xyz) です. これを, 4次元(波数, x, y, z)に直します. 
例) 波数1340点, x41点, y41点, z5点測定した場合, speloaderで読み込んだデータの形は
(1340, 8405)となっています. これを(1340, 41, 41, 5)に変更します. 以下のコードです
```Igor
wave2Dto4DMS(raw0,41,41,5)
	//最新の関数を使っていただいている場合には問題ありませんが, 
	//昔私が作った関数では, z方向にwaveがコピーされてしまう間違いがありました.
    //念のためデータブラウザでの確認をおすすめします
```
10. データの確認 上記コードを実行すると, データがCARSという名前に変換されています. 試しにデータの形を見てみます
```Igor
Display cars[][20][20][0] vs ramanshift
	//CARS[][20][20][0] はcARSという4次元waveのうち, 
	//1次元目(波数)はすべてのデータ点, 
	//空間点を示す2次元目以降はx=20, y=20, z=0の点を参照しています. 
```
12. MEMをかける波数範囲の指定
以下のコードで波数の範囲を指定します
```Igor
MEMprep(-3500,-500)
	//ここはお好みで, 解析したい範囲を入れてください. 
	//ただし, MEMでは原理的に, 波数の端はデータの質が担保できないので, 
	//500まで解析したいときは450か400まで入れたほうが良いです. 
```
13. MEMの実行
```Igor
MEMit()
	//もしくは, mem_time.ipfを読み込んでからmemtime()で実行すると実行時間を出してくれます. 
	//(自分で作っといてなんですが, ほかの方法もある気がします)
	//数分以上かかります
```
14. 横軸の取得
```Igor
makeramanshift4(m_ramanshift1) 
	//MEMが終わるとm_ramanshift1という名前の軸ができているので, ここは上記をそのままコピペで大丈夫です. 
```
15. データセーブ
```Igor
save/C re_ramanshift2
save/C imchi3_data
	//すべて終わっていれば, 軸の名前がre_ramanshift2, データの名前がimchi3_dataになっているはずです. これらを希望の位置に保存しましょう
```

### 以下は特定の状況下での技法です (常に使う必要はないです)

16. MEMした後に, 特定の波数で画像を作りたい
MEMした後, 

18. 17. 小技2 nonresonant backgroundを測定データから作りたい
